<?php

// Load PHPExcel library
require 'PHPExcel/PHPExcel.php';

// Path to the Excel file
$excelFile = 'D:/PMS/PMS/PHS.xlsx';

// Name of the worksheet containing employee data
$worksheetName = 'Data';

// Function to fetch employee data based on employee ID
function fetchEmployeeData($employeeId, $excelFile, $worksheetName) {
    // Load the Excel file
    $excelReader = PHPExcel_IOFactory::createReaderForFile($excelFile);
    $excelObj = $excelReader->load($excelFile);

    // Select the worksheet by name
    $worksheet = $excelObj->getSheetByName($worksheetName);

    // Get the highest row number and column number
    $highestRow = $worksheet->getHighestRow();
    $highestColumn = $worksheet->getHighestColumn();

    // Loop through each row to find the employee data
    for ($row = 2; $row <= $highestRow; $row++) { // Start from row 2 to skip the header
        $rowData = $worksheet->rangeToArray('A' . $row . ':' . $highestColumn . $row, NULL, TRUE, FALSE);

        // Check if the employee ID matches
        if ($rowData[0][1] == $employeeId) { // Assuming Employee ID is in column B
            // Format the employee data into an associative array
            $employeeData = array(
                "Employee Name" => $rowData[0][2], // Assuming Employee Name is in column C
                "Date of Joining" => $rowData[0][3], // Assuming Date of Joining is in column D
                "Designation" => $rowData[0][4], // Assuming Designation is in column E
                "Department" => $rowData[0][5], // Assuming Department is in column F
                "Location" => $rowData[0][6], // Assuming Location is in column G
                "Reporting Manager" => $rowData[0][7] // Assuming Reporting Manager is in column H
            );
            return $employeeData;
        }
    }
    return null; // Return null if employee ID is not found
}

// Check if the employee ID parameter is set
if (isset($_GET['employeeId'])) {
    // Get the employee ID from the query string
    $employeeId = $_GET['employeeId'];

    // Fetch employee data based on the employee ID
    $employeeData = fetchEmployeeData($employeeId, $excelFile, $worksheetName);

    // Check if employee data is found
    if ($employeeData !== null) {
        // Return employee data as JSON response
        echo json_encode($employeeData);
    } else {
        // Return error message if employee ID is not found
        echo json_encode(array("error" => "Employee not found"));
    }
} else {
    // Return error message if employee ID parameter is missing
    echo json_encode(array("error" => "Missing or invalid 'employeeId' parameter"));
}

?>
